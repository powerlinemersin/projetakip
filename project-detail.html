<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Proje DetayÄ±</title>
  <style>
    body { font-family: sans-serif; margin: 40px; background: #f5f5f5; }
    label { display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 20px; background-color: #3498db; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Proje DetaylarÄ±</h1>
  <form id="projectForm">
    <label>Proje AdÄ±<input type="text" id="name" /></label>
    <label>MÃ¼ÅŸteri AdÄ±<input type="text" id="client" /></label>
    <label>BaÅŸlangÄ±Ã§ Tarihi<input type="date" id="startDate" /></label>
    <label>BitiÅŸ Tarihi<input type="date" id="endDate" /></label>

    <h3>AÅŸamalar & Sorumlular</h3>
    <textarea id="milestones" rows="6" placeholder="Ã–rnek: KeÅŸif, Teklif, Onay, Malzeme, Uygulama..."></textarea>

    <h3>ðŸ’° BÃ¼tÃ§e YÃ¶netimi</h3>
    <label>Tahmini Malzeme Gideri (â‚º)<input type="number" id="budgetMaterial" /></label>
    <label>Tahmini Ä°ÅŸÃ§ilik Gideri (â‚º)<input type="number" id="budgetLabor" /></label>
    <label>Tahmini TaÅŸeron Gideri (â‚º)<input type="number" id="budgetSubcontractor" /></label>
    <label>GerÃ§ekleÅŸen Toplam Maliyet (â‚º)<input type="number" id="actualCost" /></label>

    <p><strong>KÃ¢r MarjÄ±:</strong> <span id="profitMargin">-</span></p>

    <button type="button" onclick="saveProject()">Kaydet</button>
  </form>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const projects = JSON.parse(localStorage.getItem('projects') || '[]');

    if (id !== null && projects[id]) {
      const proj = projects[id];
      document.getElementById('name').value = proj.name;
      document.getElementById('client').value = proj.client;
      document.getElementById('startDate').value = proj.startDate;
      document.getElementById('endDate').value = proj.endDate;
      document.getElementById('milestones').value = proj.milestones || '';
      document.getElementById('budgetMaterial').value = proj.budgetMaterial || '';
      document.getElementById('budgetLabor').value = proj.budgetLabor || '';
      document.getElementById('budgetSubcontractor').value = proj.budgetSubcontractor || '';
      document.getElementById('actualCost').value = proj.actualCost || '';
      document.getElementById('profitMargin').innerText = (proj.profit !== undefined) ? proj.profit + ' â‚º' : '-';
    }

    function saveProject() {
      if (id === null) return alert('GeÃ§ersiz proje!');

      const budgetMaterial = Number(document.getElementById('budgetMaterial').value || 0);
      const budgetLabor = Number(document.getElementById('budgetLabor').value || 0);
      const budgetSubcontractor = Number(document.getElementById('budgetSubcontractor').value || 0);
      const actualCost = Number(document.getElementById('actualCost').value || 0);
      const totalBudget = budgetMaterial + budgetLabor + budgetSubcontractor;
      const profit = totalBudget - actualCost;

      projects[id] = {
        name: document.getElementById('name').value.trim(),
        client: document.getElementById('client').value.trim(),
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        milestones: document.getElementById('milestones').value.trim(),
        budgetMaterial,
        budgetLabor,
        budgetSubcontractor,
        actualCost,
        totalBudget,
        profit
      };

      localStorage.setItem('projects', JSON.stringify(projects));
      alert('Proje gÃ¼ncellendi!');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
